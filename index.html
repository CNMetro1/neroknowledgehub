<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nero Knowledge Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Setting up custom colors for the jugs for high contrast in B/W theme */
        .color-purple { background-color: #8A2BE2; color: white; border: 1px solid black; }
        .color-yellow { background-color: #FFD700; color: black; border: 1px solid black; }
        .color-white { background-color: white; color: black; border: 1px solid black; }
        .color-pink { background-color: #FF69B4; color: black; border: 1px solid black; }
        .color-brown { background-color: #A0522D; color: white; border: 1px solid black; }
        .color-black { background-color: black; color: white; border: 1px solid white; }
        .color-silver { background-color: #E5E7EB; color: black; border: 1px solid black; }

        /* Ensuring pure black and white for main elements */
        body {
            font-family: 'Inter', sans-serif;
            background-color: white;
            color: black;
        }
        .header-bg {
            background-color: black;
            color: white;
            border-bottom: 2px solid black;
        }
        .accordion-item {
            border: 1px solid black;
            margin-bottom: 8px; /* Maintain spacing */
            border-radius: 4px; /* Added for consistency */
        }
        .accordion-header {
            background-color: black;
            color: white;
            border-bottom: 1px solid black;
        }
        .accordion-content {
            background-color: white;
            color: black;
        }
        /* Custom style for nested accordion headers to differentiate them, while staying B/W */
        .nested-accordion-header {
            /* Black background for nested headers for strong visual grouping */
            background-color: black;
            color: white;
            border-bottom: 1px solid white;
            border-top: 1px solid white;
        }
        .nested-accordion-item {
            margin-bottom: 8px;
            border: 1px solid black;
            border-radius: 4px; /* Slight rounding for nested items */
            overflow: hidden;
            display: block; /* Default display for search visibility */
        }
        /* Style for the search input container to enable relative positioning */
        .search-wrapper {
            position: relative; /* Essential for positioning the clear button */
            width: 100%;
        }
        /* Style for the search input */
        #search-input {
            width: 100%;
            padding: 10px 40px 10px 10px; /* Increased right padding for the 'x' button */
            border: 2px solid black;
            border-radius: 4px;
            font-size: 1rem;
            color: black;
            background-color: white;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }
        #search-input:focus {
            outline: none;
            border-color: #555; /* Slightly darker border on focus */
        }
        /* Style for the clear button */
        #clear-search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            padding: 2px 5px;
            line-height: 1;
            /* Initially hidden - will be controlled by JavaScript */
            display: none;
            user-select: none;
        }
        #clear-search-btn:hover {
            color: #000;
        }
        /* Custom style for sticky top offset */
        .sticky-search {
             top: 94px; /* Adjusted based on header height (approx 94px) */
             z-index: 5;
        }
        /* Scroll offset for fixed headers - uses CSS instead of complex JS calculation */
        /* Assuming Header (94px) + Search Bar (approx 56px) = ~150px */
        .accordion-item, .nested-accordion-item, .search-preview {
            scroll-margin-top: 150px; 
        }
    </style>
</head>
<body class="min-h-screen p-0 m-0">

    <header class="header-bg p-6 sticky top-0 z-10">
        <h1 class="text-3xl font-bold tracking-tight text-center">
            Nero Knowledge Hub
        </h1>
        <p class="text-sm text-center opacity-80 mt-1">
            The best Espresso this side of Milan
        </p>
    </header>

    <div class="max-w-4xl mx-auto p-4 pt-6 pb-2 sticky sticky-search bg-white">
        <div class="search-wrapper">
            <input type="text" id="search-input" placeholder="Search for 'Latte', '21 seconds', or 'FIFO'...">
            <span id="clear-search-btn" class="text-gray-500 hover:text-black transition-colors" onclick="clearSearchAndResults()">x</span>
        </div>
    </div>

    <div id="search-results" class="max-w-4xl mx-auto p-4 pt-0 space-y-3">
        <p class="text-center text-sm text-gray-500 p-4">Start typing to search the hub.</p>
    </div>

    <main id="knowledge-hub" class="max-w-4xl mx-auto p-4 pt-0 space-y-4">
        <div class="accordion-item overflow-hidden" data-target="content-1">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-1">
                <span>1. BRILLIANT AT THE BASICS</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-1" class="accordion-content p-4 hidden space-y-4 text-sm">
                <p data-block-id="p-1-1">
                    In Caffè Nero, our core principles are called <span class="font-bold italic">"Brilliant at the Basics"</span>. These principles were created at the start of the company to drive great, personalised customer service that is outstanding and different from our competitors.
                </p>

                <h3 data-block-id="h3-1-2" class="font-bold text-lg border-b border-black pb-1 pt-2">Walk the Walk all the time</h3>
                <p data-block-id="p-1-3">
                    <span class="font-bold italic">"Walk the Walk"</span> means walking consciously through the store, seeing it through the eyes of a customer. By doing this all the time, we can identify areas to improve the customer's experience.
                </p>

                <h3 data-block-id="h3-1-4" class="font-bold text-lg border-b border-black pb-1 pt-2">1-2-1 service every time</h3>
                <p data-block-id="p-1-5">
                    <span class="font-bold italic">1-2-1 service</span> is Caffè Nero's unique service style. It allows us to have personal interaction with customers and brings the human element of the service to life. It plays a big part in why our customers love coming to Caffè Nero.
                </p>
                <p data-block-id="p-1-6" class="pl-4 italic">
                    Each Barista is personally responsible for a customer's entire experience, including greeting them, taking their orders, preparing their drinks, serving their food, and taking their payment.
                </p>

                <h3 data-block-id="h3-1-7" class="font-bold text-lg border-b border-black pb-1 pt-2">2 at a time all the time</h3>
                <p data-block-id="p-1-8">
                    We serve <span class="font-bold italic">2 customers at a time</span>, which means 2 customers have to be greeted and their orders taken at the same time. Whilst you are preparing their order, remember to stand sideways to the coffee machine and talk to them.
                </p>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-2">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-2">
                <span>2. 6 STEPS OF SERVICE</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-2" class="accordion-content p-4 hidden space-y-4 text-sm">
                <p data-block-id="p-2-1">
                    The 6 Steps are our unique service steps that help us to provide consistent, fantastic service in all of our stores.
                </p>
                
                <h3 data-block-id="h3-2-2" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">1</span> – Smile and Greet</h3>
                <p data-block-id="p-2-3">
                    As soon as a customer joins the queue, acknowledge them through smiling, making eye contact, and greeting them even if you are not taking their order. This lets the customer know that you have seen them and will be with them as soon as possible.
                </p>

                <h3 data-block-id="h3-2-4" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">2</span> – Serve & Make</h3>
                <p data-block-id="p-2-5">
                    Take the customer's drink order. You will need the following information:
                </p>
                <ul data-block-id="ul-2-6" class="list-disc list-inside ml-4 space-y-1">
                    <li>Which drink they would like?</li>
                    <li>What size? (Mug or cup)</li>
                    <li>Is it to drink in or take away?</li>
                </ul>
                <p data-block-id="p-2-7" class="italic pt-2">
                    Remember to repeat the order back to the customer so that you are sure before you begin to make it.
                </p>

                <h3 data-block-id="h3-2-8" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">3</span> – Sell</h3>
                <p data-block-id="p-2-9">
                    To ensure a personalised experience, we offer specific food items to complement the customer's drink.
                </p>
                <ul data-block-id="ul-2-10" class="list-disc list-inside ml-4 space-y-1">
                    <li>When upselling, be specific and say the name of the product.</li>
                    <li>Sell your favourites and describe in your own words why you love that product.</li>
                    <li>Find the perfect partners—offering the right food with the right drink at the right time of the day.</li>
                </ul>

                <h3 data-block-id="h3-2-11" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">4</span> – App & Pay</h3>
                <p data-block-id="p-2-12">
                    Always ask your customer if they have our mobile app.
                </p>
                <ul data-block-id="ul-2-13" class="list-disc list-inside ml-4 space-y-1">
                    <li>If a customer does not have our app, use the App Conversion card and explain how they can download it.</li>
                    <li>Ensure that you give them a stamp for each handcrafted drink they purchase, as well as any other items or offers that come with a stamp.</li>
                    <li>After allocating the correct amount of stamps, process the payment.</li>
                </ul>

                <h3 data-block-id="h3-2-14" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">5</span> – Sugar & Condiments</h3>
                <p data-block-id="p-2-15">
                    Always direct customers to the condiment unit. This will ensure that customers know where to get water, napkins, sugar, and other condiments.
                </p>

                <h3 data-block-id="h3-2-16" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">6</span> – Say Thank You and Goodbye</h3>
                <p data-block-id="p-2-17">
                    Say thank you and goodbye either at the counter or while the customer is leaving, and invite them to return. Ensure that all customers leave with a smile.
                </p>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-3">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-3">
                <span>3. BARISTA PRIORITIES</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-3" class="accordion-content p-4 hidden space-y-4 text-sm">
                <p data-block-id="p-3-1">
                    Our Barista Priorities help us to keep our stores organised and create a great atmosphere for our customers.
                </p>

                <h3 data-block-id="h3-3-2" class="font-bold text-lg border-b border-black pb-1 pt-2">Customer Is King (Queue Management)</h3>
                <ul data-block-id="ul-3-3" class="list-disc list-inside ml-4 space-y-1">
                    <li><span class="font-bold italic">3 or more, off the floor</span>: If there are 3 or more customers in the queue, there should be a minimum of <span class="font-bold italic">2 Baristas</span> serving them.</li>
                </ul>
                
                <h3 data-block-id="h3-3-4" class="font-bold text-lg border-b border-black pb-1 pt-2">Clean & Clear</h3>
                <p data-block-id="p-3-5">
                    Use a <span class="font-bold italic">grey tray, damp clean blue cloth, and Sanitising spray</span> to clean. Start cleaning from outside and work your way towards the bar, clearing cups, cleaning tables, and picking up litter from the floor.
                </p>
                <ul data-block-id="ul-3-6" class="list-disc list-inside ml-4 space-y-1">
                    <li>Check and clean the condiment unit and toilets. Remember first impressions count.</li>
                    <li><span class="font-bold italic">2 or less, clean the mess</span>: If there are 2 or less customers in the queue, it is time to clean.</li>
                </ul>

                <h3 data-block-id="h3-3-7" class="font-bold text-lg border-b border-black pb-1 pt-2">Restocking</h3>
                <p data-block-id="p-3-8">
                    Abundant and well-presented food makes our stores appealing and helps to drive sales.
                </p>
                <ul data-block-id="ul-3-9" class="list-disc list-inside ml-4 space-y-1">
                    <li>Always follow <span class="font-bold italic">FIFO (First In First Out)</span> when restocking food.</li>
                    <li>Ensure displays are clean and organised and labels are present.</li>
                </ul>

                <h3 data-block-id="h3-3-10" class="font-bold text-lg border-b border-black pb-1 pt-2">Washing Up</h3>
                <p data-block-id="p-3-11">
                    Once all other priorities are taken care of, it’s time to wash up cups, saucers, cutlery, glasses, etc.
                </p>
                <ul data-block-id="ul-3-12" class="list-disc list-inside ml-4 space-y-1">
                    <li>Always ensure there are enough cups available on the coffee machine.</li>
                    <li>Rinse before loading the dishwasher, ensuring no rubbish gets into the dishwasher.</li>
                </ul>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-4">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-4">
                <span>4. GOLDEN RULES</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-4" class="accordion-content p-4 hidden space-y-4 text-sm">
                <p data-block-id="p-4-1">
                    The Golden Rules ensure that we follow high standards when making all drinks.
                </p>

                <h3 data-block-id="h3-4-2" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">1</span> – Flush</h3>
                <p data-block-id="p-4-3">
                    As soon as the handle is removed, press button 3 to <span class="font-bold italic">flush</span> the group head to clean it from excess coffee grounds.
                </p>

                <h3 data-block-id="h3-4-4" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">2</span> – Level and Wipe</h3>
                <p data-block-id="p-4-5">
                    Coffee grounds have to be <span class="font-bold italic">levelled</span> before tamping, and the handle rim must be <span class="font-bold italic">wiped</span> clean before inserting it back into the group head.
                </p>
                <ul data-block-id="ul-4-6" class="list-disc list-inside ml-4 space-y-1">
                    <li>Levelling the ground coffee in the handle ensures the coffee bed is even for a perfect extraction.</li>
                    <li>Wiping the handle removes any coffee grounds from the rim, preventing damage to the rubber seal in the group head.</li>
                </ul>

                <h3 data-block-id="h3-4-7" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">3</span> – Purge and Wipe (Steamer)</h3>
                <p data-block-id="p-4-8">
                    The steam wand has to be <span class="font-bold italic">purged</span> before and after steaming and <span class="font-bold italic">wiped</span> with a red cloth.
                </p>
                <ul data-block-id="ul-4-9" class="list-disc list-inside ml-4 space-y-1">
                    <li>Purging removes condensed water and old milk/water from the steamer.</li>
                    <li>Wiping the steamer after steaming removes milk residue, preventing it from drying and hardening.</li>
                </ul>

                <h3 data-block-id="h3-4-10" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">4</span> – Extract & Time Espresso</h3>
                <p data-block-id="p-4-11">
                    Always <span class="font-bold italic">extract and time</span> espresso to ensure the best quality for customers.
                </p>
                <ul data-block-id="ul-4-12" class="list-disc list-inside ml-4 space-y-1">
                    <li class="font-semibold">The <span class="font-bold italic">Perfect Rate of Pour for Espresso is 21 sec +/- 1 second</span>.</li>
                    <li>Any Espresso outside of this range should <span class="font-bold italic">not be served</span> to customers.</li>
                </ul>

                <h3 data-block-id="h3-4-13" class="font-bold text-lg border-b border-black pb-1 pt-2"><span class="text-xl">5</span> – Clean as you go</h3>
                <p data-block-id="p-4-14">
                    Check the coffee preparation area is <span class="font-bold italic">clean and tidy</span>.
                </p>
                <p data-block-id="p-4-15" class="italic pt-2">
                    Think with the customer's head! Would you like to buy a coffee from a dirty or disorganized bar?
                </p>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-5">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-5">
                <span>5. GREAT COFFEE</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-5" class="accordion-content p-4 hidden space-y-4 text-sm">
                <h2 data-block-id="h2-5-1" class="font-bold text-xl mb-2">Great coffee Every Time</h2>
                <p data-block-id="p-5-2">
                    As a Barista, you will be expected to deliver great coffee every time to your customers and uphold our <span class="font-bold italic">Coffee Promise</span>.
                </p>

                <h3 data-block-id="h3-5-3" class="font-bold text-lg border-b border-black pb-1 pt-2">Caffè Nero Coffee Promise</h3>
                <p data-block-id="p-5-4">
                    Premium, handcrafted Italian coffee is at the heart of Caffè Nero. We are dedicated to getting our coffee exactly right from bean to blend. From roast to barista training and expert coffee making, <span class="font-bold italic">great coffee is our craft and our passion</span>.
                </p>
                <p data-block-id="p-5-5">
                    Hence our ‘<span class="font-bold italic">coffee guarantee’</span>: we promise to make your coffee exactly how you like it. Simply talk to our baristas who will be happy to replace your coffee if it is not perfectly to your liking.
                </p>

                <h3 data-block-id="h3-5-6" class="font-bold text-lg border-b border-black pb-1 pt-2">What does this mean for you?</h3>
                <p data-block-id="p-5-7">
                    Ensure you pay attention to the details when customers are placing their orders. If they return a coffee that didn't meet their expectations, simply <span class="font-bold italic">remake it</span>.
                </p>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-6">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-6">
                <span>6. PERFECT ESPRESSO</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-6" class="accordion-content p-4 hidden space-y-4 text-sm">
                <h2 data-block-id="h2-6-1" class="font-bold text-xl mb-2">Perfect Espresso Targets</h2>

                <div data-block-id="div-6-2" class="space-y-2 mb-4">
                    <p><strong>Dose:</strong> 14–15g</p>
                    <p><strong>Rate of pour:</strong> 21 seconds +/- 1 second</p>
                    <p><strong>Crema:</strong> Hazelnut brown</p>
                </div>

                <h3 data-block-id="h3-6-3" class="font-bold text-lg border-b border-black pb-1 pt-2">Grind Size and Extraction</h3>
                <p data-block-id="p-6-4">
                    The <span class="font-bold italic">grind</span> is the particle size of ground coffee and should not be too fine or too coarse. The correct grind will result in an even and correctly timed extraction.
                </p>
                
                <p data-block-id="p-6-5" class="pt-2">
                    A <span class="font-bold italic">fine grind</span> will cause greater resistance to the flow of water through the coffee, resulting in the coffee being <span class="font-bold italic">over-extracted</span> (bitter taste).
                </p>
                <p data-block-id="p-6-6">
                    A <span class="font-bold italic">coarse grind</span> will cause less resistance to the flow of water through the coffee, resulting in the coffee being <span class="font-bold italic">under-extracted</span> (sour/weak taste).
                </p>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-7">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-7">
                <span>7. PREPARING A HANDLE</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-7" class="accordion-content p-4 hidden space-y-4 text-sm">
                <h2 data-block-id="h2-7-1" class="font-bold text-xl mb-2">8 Steps for Preparing the Handle</h2>
                <ol data-block-id="ol-7-2" class="list-decimal list-inside ml-4 space-y-3">
                    <li data-block-id="li-7-2-1">Remove the handle (portafilter) and press <span class="font-bold italic">button 3 to flush</span> the group head.</li>
                    <li data-block-id="li-7-2-2">Empty the handle on the <span class="font-bold italic">knock out bar</span>.</li>
                    <li data-block-id="li-7-2-3">Place the handle on the holder of the grinder. Press the coffee dispenser button with the handle <span class="font-bold italic">once</span>.</li>
                    <li data-block-id="li-7-2-4">Do not remove the handle until the <span class="font-bold italic">grinder stops</span> dispensing.</li>
                    <li data-block-id="li-7-2-5">Gently <span class="font-bold italic">level the coffee ground</span> with the palm of your hand.</li>
                    <li data-block-id="li-7-2-6">Place the handle onto the handle rest of the tamper and <span class="font-bold italic">pull down until you hear a click</span>.</li>
                    <li data-block-id="li-7-2-7"><span class="font-bold italic">Wipe the handle</span> rim clean.</li>
                    <li data-block-id="li-7-2-8">Insert the handle into the group head and press <span class="font-bold italic">button 2 or 4</span> depending on whether you are pulling an <span class="font-bold italic">Espresso/Ristretto</span> or a <span class="font-bold italic">"Coffee shot"</span>.</li>
                </ol>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-8">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-8">
                <span>8. MILK STEAMING</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-8" class="accordion-content p-4 hidden space-y-4 text-sm">
                <h2 data-block-id="h2-8-1" class="font-bold text-xl mb-2">The 4 Steps of Milk Steaming</h2>
                <ol data-block-id="ol-8-2" class="list-decimal list-inside ml-4 space-y-3">
                    <li data-block-id="li-8-2-1">
                        **Position Steam Wand:** Place the steam wand just <span class="font-bold italic">below the surface</span> of the milk, to the side of the jug. The steamer should never touch the bottom of the jug. <span class="font-bold italic">Activate the steamer.</span>
                    </li>
                    <li data-block-id="li-8-2-2">
                        **Inject Air:** Lower the jug slightly so the steamer is <span class="font-bold italic">level with the milk surface</span>. You should hear a <span class="font-bold italic">chirping sound</span> when injecting air.
                        <ul data-block-id="ul-8-2-3" class="list-disc list-inside ml-4 mt-1">
                            <li>Inject air up to <span class="font-bold italic">30 degrees</span> when steaming <span class="font-bold italic">Latte style</span>.</li>
                            <li>Inject air up to <span class="font-bold italic">40 degrees</span> when steaming <span class="font-bold italic">Cappuccino style</span>.</li>
                        </ul>
                    </li>
                    <li data-block-id="li-8-2-4">
                        **Create Vortex:** Raise the jug so the steamer is below the surface of the milk. Look for a <span class="font-bold italic">spinning motion</span> (the <span class="font-bold italic">vortex</span>) to incorporate the air. Stop the steamer when the milk reaches **the correct target temperature (60&deg;C for Dairy, 50&deg;C for Alternatives)**.
                    </li>
                    <li data-block-id="li-8-2-5">
                        **Bang And Swirl:** Put the jug on the side and wait <span class="font-bold italic">4–6 seconds</span> for the larger bubbles to rise to the surface. <span class="font-bold italic">Tap 3–4 times</span> to burst any big bubbles. <span class="font-bold italic">Swirl the milk</span> to create a glossy, silky finish.
                    </li>
                </ol>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-9">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-9">
                <span>9. DRINKS RECIPES</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-9" class="accordion-content p-4 hidden space-y-3 text-sm">
                <h2 data-block-id="h2-9-1" class="font-bold text-xl mb-4">Our Core Drinks Recipes</h2>

                <div class="nested-accordion-item" data-target="recipes-hot">
                    <button class="accordion-header w-full flex justify-between items-center p-3 font-semibold text-base transition duration-200 nested-accordion-header" data-target="recipes-hot">
                        <span class="font-bold">Hot Drinks</span>
                        <svg class="h-5 w-5 transform transition-transform text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="recipes-hot" class="accordion-content p-3 hidden space-y-3 bg-white">

                        <p data-block-id="hot-espresso-p-1" class="font-semibold mt-2">ESPRESSO</p>
                        <ul data-block-id="hot-espresso-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-espresso-li-1-1"><span class="font-bold italic">Prepare the handle.</span></li>
                            <li data-block-id="hot-espresso-li-1-2">Extract the espresso (<span class="font-bold italic">button 2</span>) with a timer.</li>
                            <li data-block-id="hot-espresso-li-1-3">Correct rate of pour is <span class="font-bold italic">21 seconds +/- 1 second</span>.</li>
                            <li data-block-id="hot-espresso-li-1-4">Serve in single or double espresso cups.</li>
                        </ul>

                        <p data-block-id="hot-ristretto-p-1" class="font-semibold mt-4">ESPRESSO RISTRETTO</p>
                        <ul data-block-id="hot-ristretto-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-ristretto-li-1-1"><span class="font-bold italic">Prepare the handle and tamp twice.</span></li>
                            <li data-block-id="hot-ristretto-li-1-2">Extract the espresso (<span class="font-bold italic">button 2</span>) with a timer.</li>
                            <li data-block-id="hot-ristretto-li-1-3">Press stop when the timer hits <span class="font-bold italic">15 seconds</span>.</li>
                            <li data-block-id="hot-ristretto-li-1-4">Serve in single or double espresso cups.</li>
                        </ul>

                        <p data-block-id="hot-macchiato-p-1" class="font-semibold mt-4">ESPRESSO MACCHIATO</p>
                        <ul data-block-id="hot-macchiato-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-macchiato-li-1-1"><span class="font-bold italic">Prepare the handle.</span></li>
                            <li data-block-id="hot-macchiato-li-1-2">Extract the espresso (<span class="font-bold italic">button 2</span>) with a timer (21 seconds +/- 1 second).</li>
                            <li data-block-id="hot-macchiato-li-1-3">Steam the milk in <span class="font-bold italic">Cappuccino style</span>.</li>
                            <li data-block-id="hot-macchiato-li-1-4"><span class="font-bold italic">Single Macchiato:</span> A dash of milk and <span class="font-bold italic">1 spoon of foam</span>.</li>
                            <li data-block-id="hot-macchiato-li-1-5"><span class="font-bold italic">Double Macchiato:</span> A dash of milk and <span class="font-bold italic">2 spoons of foam</span>.</li>
                            <li data-block-id="hot-macchiato-li-1-6">Serve in single or double espresso cups.</li>
                        </ul>

                        <p data-block-id="hot-panna-p-1" class="font-semibold mt-4">ESPRESSO CON PANNA</p>
                        <ul data-block-id="hot-panna-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-panna-li-1-1">Prepare a <span class="font-bold italic">Double Espresso, Button 2</span>.</li>
                            <li data-block-id="hot-panna-li-1-2">Add <span class="font-bold italic">whipped cream</span>.</li>
                            <li data-block-id="hot-panna-li-1-3">Serve in double espresso cup.</li>
                        </ul>

                        <p data-block-id="hot-cortado-p-1" class="font-semibold mt-4">CORTADO</p>
                        <ul data-block-id="hot-cortado-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-cortado-li-1-1">Prepare the espresso (<span class="font-bold italic">Single Espresso, Button 2</span>).</li>
                            <li data-block-id="hot-cortado-li-1-2">Steam the whole milk <span class="font-bold italic">Latte style</span> but stop injecting air at <span class="font-bold italic">20 degrees</span>.</li>
                            <li data-block-id="hot-cortado-li-1-3">Pour from the spout into a cortado glass. Foam: <span class="font-bold italic">0.5–1cm</span>.</li>
                        </ul>

                        <p data-block-id="hot-flatwhite-p-1" class="font-semibold mt-4">FLAT WHITE</p>
                        <ul data-block-id="hot-flatwhite-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-flatwhite-li-1-1">Prepare the <span class="font-bold italic">Espresso Ristretto (Button 2 and 15 seconds)</span>.</li>
                            <li data-block-id="hot-flatwhite-li-1-2">Steam whole milk <span class="font-bold italic">Latte style</span>. Stop injecting air at <span class="font-bold italic">20 degrees</span>.</li>
                            <li data-block-id="hot-flatwhite-li-1-3">Pour from the spout. Foam: <span class="font-bold italic">0.5–1cm</span>.</li>
                        </ul>

                        <p data-block-id="hot-latte-p-1" class="font-semibold mt-4">LATTE</p>
                        <ul data-block-id="hot-latte-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-latte-li-1-1">Prepare the espresso (<span class="font-bold italic">Button 4</span>).
                                <ul data-block-id="hot-latte-ul-2" class="list-disc list-inside ml-4 space-y-1">
                                    <li data-block-id="hot-latte-li-2-1">Regular/Grande - <span class="font-bold italic">2 shots</span></li>
                                </ul>
                            </li>
                            <li data-block-id="hot-latte-li-1-2">Steam the milk in <span class="font-bold italic">Latte style</span>. Pour from the spout of the jug. Foam: <span class="font-bold italic">1–1.5cm</span>.</li>
                        </ul>

                        <p data-block-id="hot-cappuccino-p-1" class="font-semibold mt-4">CAPPUCCINO</p>
                        <ul data-block-id="hot-cappuccino-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-cappuccino-li-1-1">Prepare the espresso (<span class="font-bold italic">Button 4</span>).
                                <ul data-block-id="hot-cappuccino-ul-2" class="list-disc list-inside ml-4 space-y-1">
                                    <li data-block-id="hot-cappuccino-li-2-1">Regular/Grande - <span class="font-bold italic">2 shots</span></li>
                                </ul>
                            </li>
                            <li data-block-id="hot-cappuccino-li-1-2">Steam the milk <span class="font-bold italic">Cappuccino style</span>. Pour from the side of the jug until you have a <span class="font-bold italic">dome</span>.</li>
                            <li data-block-id="hot-cappuccino-li-1-3">Foam: <span class="font-bold italic">2–2.5cm</span>. Add <span class="font-bold italic">chocolate powder</span> if requested.</li>
                        </ul>

                        <p data-block-id="hot-mocha-cream-p-1" class="font-semibold mt-4">MOCHA (WITH CREAM)</p>
                        <ul data-block-id="hot-mocha-cream-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-mocha-cream-li-1-1">Prepare the espresso (<span class="font-bold italic">Button 4</span>).
                                <ul data-block-id="hot-mocha-cream-ul-2" class="list-disc list-inside ml-4 space-y-1">
                                    <li data-block-id="hot-mocha-cream-li-2-1">Regular - <span class="font-bold italic">2 shots + 1 scoop</span> of chocolate</li>
                                    <li data-block-id="hot-mocha-cream-li-2-2">Grande - <span class="font-bold italic">2 shots + 1 heaped scoop</span> of chocolate</li>
                                </ul>
                            </li>
                            <li data-block-id="hot-mocha-cream-li-1-2">Mix the chocolate powder and the coffee with a <span class="font-bold italic">whisk</span>.</li>
                            <li data-block-id="hot-mocha-cream-li-1-3">Steam the milk <span class="font-bold italic">Latte style</span>. Pour from spout and add <span class="font-bold italic">whipped cream</span>, dust with chocolate powder.</li>
                        </ul>

                        <p data-block-id="hot-mocha-nocream-p-1" class="font-semibold mt-4">MOCHA (WITHOUT CREAM)</p>
                        <ul data-block-id="hot-mocha-nocream-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-mocha-nocream-li-1-1">Prepare the espresso (<span class="font-bold italic">Button 4</span>).
                                <ul data-block-id="hot-mocha-nocream-ul-2" class="list-disc list-inside ml-4 space-y-1">
                                    <li data-block-id="hot-mocha-nocream-li-2-1">Regular - <span class="font-bold italic">2 shots + 1 scoop</span> of chocolate</li>
                                    <li data-block-id="hot-mocha-nocream-li-2-2">Grande - <span class="font-bold italic">2 shots + 1 heaped scoop</span> of chocolate</li>
                                </ul>
                            </li>
                            <li data-block-id="hot-mocha-nocream-li-1-2">Mix the chocolate powder and the coffee with a <span class="font-bold italic">whisk</span>.</li>
                            <li data-block-id="hot-mocha-nocream-li-1-3">Steam the milk <span class="font-bold italic">Cappuccino style</span>. Pour from side until you have a <span class="font-bold italic">dome</span>. Foam: <span class="font-bold italic">2–2.5cm</span>. Dust with chocolate powder.</li>
                        </ul>

                        <p data-block-id="hot-americano-p-1" class="font-semibold mt-4">AMERICANO</p>
                        <ul data-block-id="hot-americano-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-americano-li-1-1">Fill the cup just over half way with <span class="font-bold italic">hot water</span>. Prepare the espresso (<span class="font-bold italic">Button 4</span>).
                                <ul data-block-id="hot-americano-ul-2" class="list-disc list-inside ml-4 space-y-1">
                                    <li data-block-id="hot-americano-li-2-1">Regular - <span class="font-bold italic">2 shots</span></li>
                                    <li data-block-id="hot-americano-li-2-2">Grande - <span class="font-bold italic">3 shots</span></li>
                                </ul>
                            </li>
                            <li data-block-id="hot-americano-li-1-2">Serve milk in a jug if requested. Add a dash of milk into the cup if taking away.</li>
                            <li data-block-id="hot-americano-li-1-3">Add paper sleeve to take away.</li>
                        </ul>

                        <p data-block-id="hot-hotchoc-p-1" class="font-semibold mt-4">HOT CHOCOLATE</p>
                        <ul data-block-id="hot-hotchoc-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-hotchoc-li-1-1">Put the milk in the jug and add the chocolate.
                                <ul data-block-id="hot-hotchoc-ul-2" class="list-disc list-inside ml-4 space-y-1">
                                    <li data-block-id="hot-hotchoc-li-2-1">Regular Drink In (8oz) - <span class="font-bold italic">2 scoops</span> of chocolate</li>
                                    <li data-block-id="hot-hotchoc-li-2-2">Regular Takeaway (10oz) - <span class="font-bold italic">2 scoops</span> of chocolate</li>
                                    <li data-block-id="hot-hotchoc-li-2-3">Grande Drink In + Takeaway (12oz) - <span class="font-bold italic">3 scoops</span> of chocolate</li>
                                </ul>
                            </li>
                            <li data-block-id="hot-hotchoc-li-1-2">Steam the chocolate and milk in <span class="font-bold italic">Latte style</span>. Pour the hot chocolate from the spout.</li>
                            <li data-block-id="hot-hotchoc-li-1-3">Add <span class="font-bold italic">whipped cream</span> and chocolate chips if requested.</li>
                        </ul>

                        <p data-block-id="hot-tea-p-1" class="font-semibold mt-4">TEA</p>
                        <ul data-block-id="hot-tea-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="hot-tea-li-1-1">Put <span class="font-bold italic">1 teabag</span> into the mug, teapot or takeaway cup. Add <span class="font-bold italic">hot water</span>.</li>
                            <li data-block-id="hot-tea-li-1-2">Serve milk in a jug if requested. Add a dash of milk into the cup if taking away.</li>
                            <li data-block-id="hot-tea-li-1-3">Add paper sleeve to take away.</li>
                        </ul>
                    </div>
                </div>

                <div class="nested-accordion-item" data-target="recipes-iced">
                    <button class="accordion-header w-full flex justify-between items-center p-3 font-semibold text-base transition duration-200 nested-accordion-header" data-target="recipes-iced">
                        <span class="font-bold">Iced Drinks</span>
                        <svg class="h-5 w-5 transform transition-transform text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="recipes-iced" class="accordion-content p-3 hidden space-y-3 bg-white">

                        <p data-block-id="iced-latte-p-1" class="font-semibold mt-2">ICED LATTES</p>
                        <ul data-block-id="iced-latte-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="iced-latte-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract <span class="font-bold italic">2 shots of espresso (button 2)</span>, leave to cool until served.</li>
                            <li data-block-id="iced-latte-li-1-2"><span class="font-bold italic">Milk:</span> Fill to <span class="font-bold italic">line 2</span> in the measuring beaker.</li>
                            <li data-block-id="iced-latte-li-1-3"><span class="font-bold italic">Flavored:</span> If flavored, add <span class="font-bold italic">2 pumps of FLAVOUR syrup</span>. Swirl to blend.</li>
                            <li data-block-id="iced-latte-li-1-4"><span class="font-bold italic">2. Serve:</span> Fill serving cup with <span class="font-bold italic">ice</span>. Pour milk into cup. Top with extracted espresso.</li>
                            <li data-block-id="iced-latte-li-1-5" class="pl-4 pt-1"><span class="font-bold italic">Recipe Variations:</span> Pistachio (Salted Caramel & Pistachio Syrup), Caramel (Caramel Syrup), Vanilla (Vanilla Syrup).</li>
                        </ul>

                        <p data-block-id="iced-americano-p-1" class="font-semibold mt-4">ICED AMERICANO</p>
                        <ul data-block-id="iced-americano-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="iced-americano-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract <span class="font-bold italic">2 shots of espresso (button 2)</span>, leave to cool until served.</li>
                            <li data-block-id="iced-americano-li-1-2"><span class="font-bold italic">Water:</span> Use water line <span class="font-bold italic">4 (from iced water jug)</span>. Pour into serving cup.</li>
                            <li data-block-id="iced-americano-li-1-3"><span class="font-bold italic">2. Serve:</span> Fill serving cup with <span class="font-bold italic">ice</span>. Pour espresso into serving cup. Dash of milk if requested.</li>
                        </ul>

                        <p data-block-id="iced-velvet-p-1" class="font-semibold mt-4">ICED VELVET AMERICANO</p>
                        <ul data-block-id="iced-velvet-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="iced-velvet-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract <span class="font-bold italic">2 shots of espresso (button 2)</span>. Pour directly into measuring beaker.</li>
                            <li data-block-id="iced-velvet-li-1-2"><span class="font-bold italic">Water:</span> Water (from iced water jug) <span class="font-bold italic">line 2</span>.</li>
                            <li data-block-id="iced-velvet-li-1-3"><span class="font-bold italic">Ice:</span> <span class="font-bold italic">4 ice cubes</span>.</li>
                            <li data-block-id="iced-velvet-li-1-4"><span class="font-bold italic">Red Jug:</span> Pour prepared mix into <span class="font-bold italic">RED jug</span>.</li>
                            <li data-block-id="iced-velvet-li-1-5"><span class="font-bold italic">2. Blend:</span> Add <span class="font-bold italic">2 pumps of FLAVOUR syrup</span>. Use <span class="font-bold italic">Program 3</span>.</li>
                            <li data-block-id="iced-velvet-li-1-6"><span class="font-bold italic">3. Serve:</span> Fill serving cup with <span class="font-bold italic">ice</span>. Pour jug into cup. Dash of milk if requested.</li>
                        </ul>

                        <p data-block-id="iced-flatwhite-p-1" class="font-semibold mt-4">ICED FLAT WHITE</p>
                        <ul data-block-id="iced-flatwhite-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="iced-flatwhite-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract <span class="font-bold italic">2 shots of espresso (button 2)</span>, leave to cool until blend.</li>
                            <li data-block-id="iced-flatwhite-li-1-2"><span class="font-bold italic">2. Blend:</span> Add **4 ice cubes** and **extracted espresso** into the <span class="font-bold italic">RED jug</span>. Blend using <span class="font-bold italic">Program 3</span>.</li>
                            <li data-block-id="iced-flatwhite-li-1-3"><span class="font-bold italic">3. Serve:</span> Add <span class="font-bold italic">whole milk line 2</span> (using measuring beaker) and **4 ice cubes** into the serving cup. Pour in the **foamed espresso from the blender**.</li>
                            <li data-block-id="iced-flatwhite-li-1-4"><span class="font-bold italic">Finish:</span> Serve with black straw, napkin and flat lid.</li>
                        </ul>

                        <p data-block-id="iced-cappuccino-p-1" class="font-semibold mt-4">ICED CAPPUCCINO</p>
                        <ul data-block-id="iced-cappuccino-ul-1" class="list-disc list-inside ml-4 space-y-1">
                            <li data-block-id="iced-cappuccino-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract <span class="font-bold italic">2 shots of espresso (button 2)</span>, leave to cool until serve.</li>
                            <li data-block-id="iced-cappuccino-li-1-2"><span class="font-bold italic">2. Blend:</span> Combine **skimmed milk line 2**, **Ice line 4**, and pour into the <span class="font-bold italic">RED blender jug</span>. Blend using <span class="font-bold italic">Program 3</span>.</li>
                            <li data-block-id="iced-cappuccino-li-1-3"><span class="font-bold italic">3. Serve:</span> Add **4 ice cubes** into the serving cup, then the **extracted espresso**. Pour in the **foamed milk from the blender**.</li>
                            <li data-block-id="iced-cappuccino-li-1-4"><span class="font-bold italic">Finish:</span> Offer a **dusting of chocolate powder**. Serve with black straw, napkin and flat lid.</li>
                        </ul>

                        <h3 data-block-id="h3-iced-frappe-1" class="font-bold text-lg border-b border-black pb-1 pt-4">Standard Frappes</h3>

                        <p data-block-id="frappe-latte-p-1" class="font-semibold mt-2 border-b border-black pb-1">FRAPPE LATTE</p>
                        <ul data-block-id="frappe-latte-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="frappe-latte-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract **2 shots of espresso (button 2)**, leave to cool until serve.</li>
                            <li data-block-id="frappe-latte-li-1-2"><span class="font-bold italic">Mix:</span> Add <span class="font-bold italic">Milk line 4</span> and <span class="font-bold italic">Ice line 7</span>. Pour into blender jug.</li>
                            <li data-block-id="frappe-latte-li-1-3"><span class="font-bold italic">2. Blend:</span> Add **2 flat BLUE scoops of frappe powder** and **extracted espresso**. Blend using <span class="font-bold italic">Program 1</span>.</li>
                            <li data-block-id="frappe-latte-li-1-4"><span class="font-bold italic">3. Serve:</span> Pour into serving cup. Offer any extra jug contents to customer in small TA cup.</li>
                            <li data-block-id="frappe-latte-li-1-5"><span class="font-bold italic">Finish:</span> Option to upsell <span class="font-bold italic">whipped cream</span>. Serve with white straw, napkin and flat lid (use dome lid if cream upsold).</li>
                        </ul>

                        <p data-block-id="frappe-mocha-p-1" class="font-semibold mt-4 border-b border-black pb-1">FRAPPE MOCHA</p>
                        <ul data-block-id="frappe-mocha-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="frappe-mocha-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract <span class="font-bold italic">2 shots of espresso (button 2)</span> and leave to cool until blend.</li>
                            <li data-block-id="frappe-mocha-li-1-2"><span class="font-bold italic">Mix:</span> Add <span class="font-bold italic">Luxury chocolate to line 1</span>, <span class="font-bold italic">Milk line 2</span>, and <span class="font-bold italic">Ice line 7</span>. Pour into blender jug.</li>
                            <li data-block-id="frappe-mocha-li-1-3"><span class="font-bold italic">2. Blend:</span> Add **2 flat BLUE scoops of frappe powder** and **extracted espresso**. Blend using <span class="font-bold italic">Program 1</span>.</li>
                            <li data-block-id="frappe-mocha-li-1-4"><span class="font-bold italic">3. Serve:</span> Pour into serving cup. Offer any extra jug contents to customer in small TA cup.</li>
                            <li data-block-id="frappe-mocha-li-1-5"><span class="font-bold italic">Finish:</span> Option to upsell <span class="font-bold italic">whipped cream</span>. Serve with white straw, napkin and flat lid (use dome lid if cream upsold).</li>
                        </ul>
                    </div>
                </div>

                <div class="nested-accordion-item" data-target="recipes-luxury">
                    <button class="accordion-header w-full flex justify-between items-center p-3 font-semibold text-base transition duration-200 nested-accordion-header" data-target="recipes-luxury">
                        <span class="font-bold">Luxury Drinks</span>
                        <svg class="h-5 w-5 transform transition-transform text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    <div id="recipes-luxury" class="accordion-content p-3 hidden space-y-3 bg-white">

                        <p data-block-id="lux-hotchoc-p-1" class="font-semibold mt-2 border-b border-black pb-1">LUXURY HOT CHOCOLATE</p>
                        <ul data-block-id="lux-hotchoc-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="lux-hotchoc-li-1-1">Pour the <span class="font-bold italic">Luxury Chocolate into jug</span>.</li>
                            <li data-block-id="lux-hotchoc-li-1-2">Pour into Latte glass or regular Takeaway cup.</li>
                            <li data-block-id="lux-hotchoc-li-1-3">Add **whipped cream** if requested and **chocolate chips**.</li>
                            <li data-block-id="lux-hotchoc-li-1-4"><span class="font-bold italic">Note:</span> Heat to **60 degrees** (as per milk steaming guidance).</li>
                        </ul>

                        <p data-block-id="lux-mocha-p-1" class="font-semibold mt-4 border-b border-black pb-1">LUXURY MOCHA</p>
                        <ul data-block-id="lux-mocha-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="lux-mocha-li-1-1">Prepare the <span class="font-bold italic">Espresso Ristretto (Button 2 and 15 seconds)</span>. Add to Latte glass.</li>
                            <li data-block-id="lux-mocha-li-1-2">Add <span class="font-bold italic">Luxury Chocolate to line 2</span> in the measuring beaker. Pour the Luxury Chocolate into a milk jug.</li>
                            <li data-block-id="lux-mocha-li-1-3">Steam the milk, **heat to 60 degrees**.</li>
                            <li data-block-id="lux-mocha-li-1-4">Pour into Latte glass or regular Takeaway cup.</li>
                            <li data-block-id="lux-mocha-li-1-5">Add **whipped cream** if requested and **chocolate powder**.</li>
                        </ul>

                        <p data-block-id="lux-white-mocha-p-1" class="font-semibold mt-4 border-b border-black pb-1">WHITE CHOCOLATE MOCHA</p>
                        <ul data-block-id="lux-white-mocha-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="lux-white-mocha-li-1-1"><span class="font-bold italic">Grande Size Only:</span> Prepare the **Espresso (Button 4)** and add **2 pumps white chocolate sauce**.</li>
                            <li data-block-id="lux-white-mocha-li-1-2">Mix the sauce and coffee using a **whisk**.</li>
                            <li data-block-id="lux-white-mocha-li-1-3"><span class="font-bold italic">With Cream:</span> Steam the milk <span class="font-bold italic">Latte style</span>. Pour from the spout, add **whipped cream** and **chocolate powder**.</li>
                            <li data-block-id="lux-white-mocha-li-1-4"><span class="font-bold italic">Without Cream:</span> Steam the milk <span class="font-bold italic">Cappuccino style</span>. Pour the milk from the side until you get a **dome** dust with **chocolate powder**.</li>
                        </ul>

                        <p data-block-id="lux-caramel-latte-p-1" class="font-semibold mt-4 border-b border-black pb-1">LUXURY CARAMEL LATTE</p>
                        <ul data-block-id="lux-caramel-latte-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="lux-caramel-latte-li-1-1"><span class="font-bold italic">Grande Size Only:</span> Prepare the **Espresso**.</li>
                            <li data-block-id="lux-caramel-latte-li-1-2">Add **3 pumps of vanilla syrup**.</li>
                            <li data-block-id="lux-caramel-latte-li-1-3">Steam the milk <span class="font-bold italic">Latte style</span>. Pour from the spout of the jug.</li>
                            <li data-block-id="lux-caramel-latte-li-1-4">Add **whipped cream** on top and a **drizzle of caramel sauce**.</li>
                        </ul>

                        <p data-block-id="lux-chai-latte-p-1" class="font-semibold mt-4 border-b border-black pb-1">CHAI LATTE</p>
                        <ul data-block-id="lux-chai-latte-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="lux-chai-latte-li-1-1"><span class="font-bold italic">Grande Size Only:</span> Steam the milk <span class="font-bold italic">Latte style</span>.</li>
                            <li data-block-id="lux-chai-latte-li-1-2">Add **30ml of chai powder** to a small amount of **hot water**. Mix together to create a **paste**.</li>
                            <li data-block-id="lux-chai-latte-li-1-3">Add a **dash of milk** and mix again.</li>
                            <li data-block-id="lux-chai-latte-li-1-4">Pour the rest of the milk from the spout and **dust with cinnamon**. Foam: <span class="font-bold italic">1–1.5cm</span>.</li>
                        </ul>

                        <h3 data-block-id="h3-lux-frappe-1" class="font-bold text-lg border-b border-black pb-1 pt-4">Luxury Frappes</h3>

                        <p data-block-id="lux-caramel-frappe-p-1" class="font-semibold mt-2 border-b border-black pb-1">ESPRESSO CARAMEL FRAPPE</p>
                        <ul data-block-id="lux-caramel-frappe-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="lux-caramel-frappe-li-1-1"><span class="font-bold italic">1. Prepare:</span> Extract **2 shots of espresso (button 2)**, leave to cool until serve. Add **Whole milk line 2** and **Ice line 8**. Pour into blender jug.</li>
                            <li data-block-id="lux-caramel-frappe-li-1-2"><span class="font-bold italic">2. Blend:</span> Add **4 pumps frappe syrup** and **3 pumps caramel sauce**. Blend using <span class="font-bold italic">Program 1</span>.</li>
                            <li data-block-id="lux-caramel-frappe-li-1-3"><span class="font-bold italic">3. Serve:</span> Pour jug into serving cup (leave room for espresso). Add **extracted espresso**, **add cream**, and **3 swirls caramel drizzle**.</li>
                            <li data-block-id="lux-caramel-frappe-li-1-4"><span class="font-bold italic">Finish:</span> Serve with white straw, napkin and dome lid.</li>
                        </ul>

                        <p data-block-id="lux-millionaires-frappe-p-1" class="font-semibold mt-4 border-b border-black pb-1">MILLIONAIRES FRAPPE</p>
                        <ul data-block-id="lux-millionaires-frappe-ul-1" class="list-disc list-inside ml-4 space-y-1 pt-2">
                            <li data-block-id="lux-millionaires-frappe-li-1-1"><span class="font-bold italic">1. Prepare:</span> If upsold: Extract **2 shots espresso (button 2)**, leave to cool until serve. Add **Whole milk line 2** and **Ice line 8**. Pour into blender jug.</li>
                            <li data-block-id="lux-millionaires-frappe-li-1-2"><span class="font-bold italic">2. Blend:</span> Add **4 pumps frappe syrup** and **3 pumps caramel sauce**. Blend using <span class="font-bold italic">Program 1</span>.</li>
                            <li data-block-id="lux-millionaires-frappe-li-1-3"><span class="font-bold italic">3. Serve:</span> Add **Luxury Chocolate line 1** in TA serving cup (drink in - use measuring beaker). Pour jug into cup (leave room for espresso if ordered). Add extracted espresso if requested, **add chocolate cream**, and **3 swirls caramel drizzle**.</li>
                            <li data-block-id="lux-millionaires-frappe-li-1-4"><span class="font-bold italic">Finish:</span> Serve with white straw, napkin and dome lid. **Option to upsell espresso.**</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
        
        <div class="accordion-item overflow-hidden" data-target="content-10">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-10">
                <span>10. MILK GUIDE</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-10" class="accordion-content p-4 hidden space-y-4 text-sm">
                <h2 data-block-id="h2-10-1" class="font-bold text-xl mb-2">Milk Types, Temperatures & Jug Guide</h2>
                
                <h3 data-block-id="h3-10-2" class="font-bold text-lg border-b border-black pb-1 pt-2">Milk Types & Target Temperatures</h3>
                <p data-block-id="p-10-3">
                    We use **Whole, Semi-Skimmed, and Skimmed Dairy Milk**, alongside **Alpro Barista** alternatives (Oat, Soya, Coconut, and Almond). We also use a **Vegan Suitable Hot Chocolate Powder** and a **Soya-Based Luxury Chocolate Base**.
                </p>
                <ul data-block-id="ul-10-4" class="list-disc list-inside ml-4 space-y-1">
                    <li data-block-id="ul-10-4-1"><span class="font-bold italic">Dairy Milk (Whole, Semi-Skimmed, Skimmed):</span> Target Temperature is <span class="font-bold italic">60&deg;C</span>.</li>
                    <li data-block-id="ul-10-4-2"><span class="font-bold italic">Milk Alternatives (Oat, Soya, Coconut, Almond):</span> Target Temperature is <span class="font-bold italic">50&deg;C</span> (lower heat prevents curdling/flavor change).</li>
                    <li data-block-id="ul-10-4-3"><span class="font-bold italic">Luxury Chocolate Base:</span> Target Temperature is <span class="font-bold italic">60&deg;C</span>.</li>
                </ul>

                <h3 data-block-id="h3-10-5" class="font-bold text-lg border-b border-black pb-1 pt-2">Color-Coded Jug Guide</h3>
                <p data-block-id="p-10-6">
                    To prevent cross-contamination and ensure quality, dedicated, color-coded jugs must be used for each product.
                </p>
                <ul data-block-id="ul-10-7" class="list-none ml-4 space-y-2">
                    <li data-block-id="li-10-7-1" class="p-2 color-silver rounded-md"><span class="font-bold">Silver Jug (No Tags):</span> Dairy Milks (Whole, Semi, Skimmed).</li>
                    <li data-block-id="li-10-7-2" class="p-2 color-purple rounded-md"><span class="font-bold">Purple Tag Jug:</span> Oat Milk.</li>
                    <li data-block-id="li-10-7-3" class="p-2 color-yellow rounded-md"><span class="font-bold">Yellow Tag Jug:</span> Soya Milk.</li>
                    <li data-block-id="li-10-7-4" class="p-2 color-white rounded-md"><span class="font-bold">White Tag Jug:</span> Coconut Milk.</li>
                    <li data-block-id="li-10-7-5" class="p-2 color-pink rounded-md"><span class="font-bold">Pink Tag Jug:</span> Almond Milk.</li>
                    <li data-block-id="li-10-7-6" class="p-2 color-brown rounded-md"><span class="font-bold">Brown Tag Jug:</span> Hot Chocolate Powder (when used with dairy milk).</li>
                    <li data-block-id="li-10-7-7" class="p-2 color-black rounded-md"><span class="font-bold">Black Tag Jug:</span> Luxury Chocolate Base.</li>
                </ul>
                <p data-block-id="p-10-8" class="pt-2 italic">
                    **Hot Chocolate Rule:** When making a Hot Chocolate with alternative milk (e.g., Oat Hot Chocolate), use the **appropriate color-coded jug** for that alternative milk.
                </p>

                <h3 data-block-id="h3-10-9" class="font-bold text-lg border-b border-black pb-1 pt-2">Steaming Techniques & Storage Rules</h3>
                <ul data-block-id="ul-10-10" class="list-disc list-inside ml-4 space-y-1">
                    <li data-block-id="ul-10-10-1">Do not steam milk more than <span class="font-bold italic">once</span>; discard any leftover milk from the jug after use.</li>
                    <li data-block-id="ul-10-10-2">Always follow <span class="font-bold italic">FIFO (First In First Out)</span> when stocking and using open milk cartons.</li>
                    <li data-block-id="ul-10-10-3">Always store milk below <span class="font-bold italic">4&deg;C (40&deg;F)</span>.</li>
                    <li data-block-id="ul-10-10-4">Purge and wipe the steam wand immediately after every use.</li>
                </ul>
            </div>
        </div>

        <div class="accordion-item overflow-hidden" data-target="content-11">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-11">
                <span>11. FOOD HANDLING & SAFETY</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-11" class="accordion-content p-4 hidden space-y-4 text-sm">
                <h2 data-block-id="h2-11-1" class="font-bold text-xl mb-2">Core Principles of Food Safety</h2>

                <h3 data-block-id="h3-11-2" class="font-bold text-lg border-b border-black pb-1 pt-2">FIFO and Stock Rotation</h3>
                <p data-block-id="p-11-3">
                    <span class="font-bold italic">FIFO (First In First Out)</span> is essential for maintaining product freshness and preventing waste.
                </p>
                <ul data-block-id="ul-11-4" class="list-disc list-inside ml-4 space-y-1">
                    <li>When putting new stock away, place items with the nearest expiry dates at the front.</li>
                    <li>Always check the <span class="font-bold italic">Date Dots</span> on products (day opened) and compare against the use-by date.</li>
                    <li>Expired or damaged stock must be removed immediately.</li>
                </ul>

                <h3 data-block-id="h3-11-5" class="font-bold text-lg border-b border-black pb-1 pt-2">Temperature Control (The Danger Zone)</h3>
                <p data-block-id="p-11-6">
                    Food must be stored, chilled, or heated correctly to prevent the growth of harmful bacteria.
                </p>
                <ul data-block-id="ul-11-7" class="list-disc list-inside ml-4 space-y-1">
                    <li>The **Danger Zone** for bacterial growth is between <span class="font-bold italic">8&deg;C and 63&deg;C</span>.</li>
                    <li>**Refrigerated food** must be stored at <span class="font-bold italic">4&deg;C or below</span>.</li>
                    <li>**Freezer food** must be stored at <span class="font-bold italic">-18&deg;C or below</span>.</li>
                    <li>**Hot Food** (e.g., items in the hot display) must be held above <span class="font-bold italic">63&deg;C</span>.</li>
                </ul>

                <h3 data-block-id="h3-11-8" class="font-bold text-lg border-b border-black pb-1 pt-2">Cross-Contamination Prevention</h3>
                <p data-block-id="p-11-9">
                    Separation is key to prevent bacteria from raw or soiled surfaces transferring to ready-to-eat food.
                </p>
                <ul data-block-id="ul-11-10" class="list-disc list-inside ml-4 space-y-1">
                    <li>Use <span class="font-bold italic">dedicated coloured chopping boards and cloths</span> for different tasks (e.g., Blue for general cleaning, Red for raw meat/steam wand).</li>
                    <li>Always wash hands thoroughly between tasks, especially after handling waste, cleaning, or touching raw/unpackaged ingredients.</li>
                    <li>Store raw food (if applicable) below ready-to-eat food in the chiller.</li>
                </ul>
            </div>
        </div>
        
        <div class="accordion-item overflow-hidden" data-target="content-12">
            <button class="accordion-header w-full flex justify-between items-center p-4 font-semibold text-lg transition duration-200" data-target="content-12">
                <span>12. ALLERGY AWARENESS & PROTOCOL</span>
                <svg class="h-6 w-6 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="content-12" class="accordion-content p-4 hidden space-y-4 text-sm">
                <h2 data-block-id="h2-12-1" class="font-bold text-xl mb-2">Allergy Protocol & Risk Communication</h2>

                <h3 data-block-id="h3-12-2" class="font-bold text-lg border-b border-black pb-1 pt-2">The Golden Question</h3>
                <p data-block-id="p-12-3">
                    Whenever a customer requests an alternative milk or an allergen-free item, you <span class="font-bold italic">must</span> ask:
                </p>
                <blockquote data-block-id="blockquote-12-4" class="italic p-3 bg-gray-100 border-l-4 border-black">
                    "Is this due to an **allergy or intolerance**, or is it just a preference?"
                </blockquote>

                <h3 data-block-id="h3-12-5" class="font-bold text-lg border-b border-black pb-1 pt-2">Communicating the Risk</h3>
                <p data-block-id="p-12-6">
                    If the customer states it is due to an allergy/intolerance, you must clearly communicate the risk.
                </p>
                <div data-block-id="div-12-7" class="border border-red-500 bg-red-100 p-3 rounded-md">
                    <p class="text-sm font-semibold text-black">
                        "We cannot guarantee an allergen-free environment due to the use of shared equipment, such as **steam wands, blenders, and benches**. Despite our cleaning procedures, there is always a risk of <span class="font-extrabold">cross-contamination</span>."
                    </p>
                </div>
                <ul data-block-id="ul-12-8" class="list-disc list-inside ml-4 space-y-1 pt-2">
                    <li>Always ask the customer if they are still happy to proceed after explaining the risk.</li>
                    <li>If they are unsure, offer a pre-packaged item, as these are often safer.</li>
                </ul>

                <h3 data-block-id="h3-12-9" class="font-bold text-lg border-b border-black pb-1 pt-2">Allergy Mitigation Steps</h3>
                <p data-block-id="p-12-10">
                    If an allergy customer chooses to proceed, follow these steps to minimize risk:
                </p>
                <ol data-block-id="ol-12-11" class="list-decimal list-inside ml-4 space-y-1">
                    <li data-block-id="li-12-11-1">Wash hands and put on fresh gloves.</li>
                    <li data-block-id="li-12-11-2">Use a <span class="font-bold italic">fresh, clean, color-coded jug</span> (from Section 10).</li>
                    <li data-block-id="li-12-11-3">Thoroughly clean and purge the steam wand using a <span class="font-bold italic">sanitising probe wipe</span> **before** making the drink.</li>
                    <li data-block-id="li-12-11-4">Clean the immediate preparation area/bench surface before preparing.</li>
                    <li data-block-id="li-12-11-5">Use pre-packaged milk cartons where possible, and open a **fresh carton** to guarantee no contamination from a spout/jug.</li>
                </ol>
            </div>
        </div>

    </main>

    <script>
        // Get global element references for easy access in functions
        const searchInput = document.getElementById('search-input');
        const clearButton = document.getElementById('clear-search-btn');
        const searchResults = document.getElementById('search-results');
        const mainContent = document.getElementById('knowledge-hub');
        const allItems = mainContent.querySelectorAll('.accordion-item');
        
        // The scroll offset is now handled by the CSS 'scroll-margin-top: 150px;' property on the scroll targets.
        // We no longer need to calculate the offset in JS.

        // --- NEW CLEAR BUTTON LOGIC ---

        /**
         * Clears the search input and results display, then re-runs the search to hide the button.
         */
        function clearSearchAndResults() {
            // 1. Clear the input field's value
            searchInput.value = ''; 
            
            // 2. Force trigger the search logic (this will handle the button visibility and reset results)
            performSearchLogic(); 

            // 3. Make sure main content is visible after clearing search
            mainContent.style.display = 'block'; 
            
            // 4. (Optional) Put the focus back on the input for immediate typing
            searchInput.focus(); 
        }

        /**
         * Toggles the visibility of the clear button based on input content.
         */
        function toggleClearButton() {
            // Show the button only if there is text in the search input
            if (searchInput.value.length > 0) {
                clearButton.style.display = 'block';
            } else {
                clearButton.style.display = 'none';
            }
        }
        
        // Combine the search logic into a single function for re-use
        function performSearchLogic() {
            const query = searchInput.value.toLowerCase().trim();
            searchResults.innerHTML = '';
            
            // Call the function to show/hide the 'x' button
            toggleClearButton();
            
            if (query.length < 3) {
                searchResults.innerHTML = `<p class="text-center text-sm text-gray-500 p-4">${query.length > 0 ? 'Keep typing for results...' : 'Start typing to search the hub.'}</p>`;
                mainContent.style.display = 'block'; // Show main content when search is inactive/too short
                return;
            }

            mainContent.style.display = 'none'; // Hide main content when search is active
            
            let resultsHtml = '';

            allItems.forEach(item => {
                const contentTarget = item.getAttribute('data-target');
                
                // 1. Check top-level content
                resultsHtml += generatePreview(item, query, false);

                // 2. Check nested content (only if it's the recipes section)
                if (contentTarget === 'content-9') {
                    item.querySelectorAll('.nested-accordion-item').forEach(nestedItem => {
                        resultsHtml += generatePreview(nestedItem, query, true);
                    });
                }
            });
            
            // Inject results or a "no results" message
            if (resultsHtml) {
                // Inject a results title
                searchResults.innerHTML = `
                    <h2 class="text-xl font-bold border-b border-black pb-2 mb-3 mt-1">Search Results</h2>
                    <div class="space-y-3">${resultsHtml}</div>
                `;
                addPreviewListeners(); // Attach click listeners to new results
            } else {
                searchResults.innerHTML = `<p class="text-center text-sm text-gray-500 p-4">No matches found for "${query}".</p>`;
                mainContent.style.display = 'block'; // Show content again if search yields nothing
            }
        }

        // --- Accordion Functionality (Retained for manual clicks) ---
        const accordionHeaders = document.querySelectorAll('.accordion-header');
        
        accordionHeaders.forEach(header => {
            header.addEventListener('click', (event) => {
                const targetId = header.getAttribute('data-target');
                const content = document.getElementById(targetId);
                const isNested = header.classList.contains('nested-accordion-header');

                // Stop propagation for nested headers to prevent the main accordion item from closing
                if (isNested) {
                    event.stopPropagation();
                }

                if (content) {
                    const isCurrentlyOpen = !content.classList.contains('hidden');

                    // Toggle the clicked section
                    if (isCurrentlyOpen) {
                        content.classList.add('hidden');
                        header.querySelector('svg').classList.remove('rotate-180');
                    } else {
                        // Close all *relevant* sibling sections
                        const parentElement = isNested ? header.closest('.accordion-content') : mainContent;
                        
                        parentElement.querySelectorAll('.accordion-item, .nested-accordion-item').forEach(item => {
                            const siblingHeader = item.querySelector('.accordion-header[data-target]');
                            const siblingContent = document.getElementById(siblingHeader.getAttribute('data-target'));
                            
                            if (siblingContent && siblingContent.id !== targetId) {
                                // Ensure we only target siblings of the same 'level'
                                const isSiblingNested = siblingHeader.classList.contains('nested-accordion-header');
                                
                                if ((isNested && isSiblingNested && item.closest('.accordion-content') === parentElement) || 
                                    (!isNested && !isSiblingNested)) {
                                    
                                    siblingContent.classList.add('hidden');
                                    siblingHeader.querySelector('svg').classList.remove('rotate-180');
                                }
                            }
                        });
                        
                        // Open the clicked section
                        content.classList.remove('hidden');
                        header.querySelector('svg').classList.add('rotate-180');

                        // SCROLL LOGIC (Simplified with scrollIntoView and CSS scroll-margin-top)
                        const itemToScroll = isNested ? header.closest('.nested-accordion-item') : header.closest('.accordion-item');

                        if (itemToScroll) {
                            itemToScroll.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start' // Scrolls the top of the element to the start of the viewport
                            });
                        }
                    }
                }
            });
        });


        // --- Search Functionality (Previews) ---
        
        // Function to get the header text from a nested item (for better context in preview)
        function getNestedHeaderTitle(nestedItem) {
            const parentItem = nestedItem.closest('.accordion-item');
            const parentTitle = parentItem ? parentItem.querySelector('.accordion-header span').textContent : '';
            const nestedHeader = nestedItem.querySelector('.nested-accordion-header span');
            const nestedTitle = nestedHeader ? nestedHeader.textContent : 'Nested Section';
            return `${parentTitle.split('. ')[1] || parentTitle} > ${nestedTitle}`;
        }

        // Function to get the block's most relevant sub-heading (Updated for robustness)
        function getBlockSubTitle(block, nestedItem = null) {
            let current = block;
            
            // Search backwards for the nearest preceding H3 or a recipe title P
            // within the bounds of the current content section.
            const contentBoundary = current.closest('.accordion-content') || current.closest('.nested-accordion-item');
            
            let precedingElement = current;
            let foundTitle = null;

            // Use a while loop to step backward through siblings until the boundary or a title is found
            // This is a more comprehensive backward search than just previousElementSibling
            while (precedingElement && precedingElement !== contentBoundary) {
                if (precedingElement.previousElementSibling) {
                    precedingElement = precedingElement.previousElementSibling;
                } else {
                    // If no previous sibling, move up to the parent and then check its previous sibling
                    precedingElement = precedingElement.parentElement;
                    if (precedingElement && precedingElement !== contentBoundary && precedingElement.previousElementSibling) {
                        precedingElement = precedingElement.previousElementSibling;
                    } else {
                        break; // Stop if we hit the boundary or can't move backward
                    }
                }
                
                // Check if the current preceding element is a suitable title
                if (precedingElement) {
                    // H3 is always a strong title
                    if (precedingElement.tagName === 'H3') {
                        foundTitle = precedingElement.textContent.trim();
                        break;
                    }
                    // A P with 'font-semibold' class is used for recipe/step titles
                    if (precedingElement.tagName === 'P' && precedingElement.classList.contains('font-semibold') && precedingElement.textContent.trim().length > 0) {
                        // Check if it's the recipe/step title and not just a paragraph containing a list
                        if (!precedingElement.querySelector('ul, ol')) {
                            foundTitle = precedingElement.textContent.trim();
                            break;
                        }
                    }
                    // If the block is nested in a list (UL/OL), we need to look at what precedes the list itself
                    if (precedingElement.tagName === 'UL' || precedingElement.tagName === 'OL') {
                        let listPrev = precedingElement.previousElementSibling;
                        while (listPrev && listPrev !== contentBoundary) {
                             if (listPrev.tagName === 'H3' || (listPrev.tagName === 'P' && listPrev.classList.contains('font-semibold'))) {
                                foundTitle = listPrev.textContent.trim();
                                break;
                            }
                            listPrev = listPrev.previousElementSibling;
                        }
                        if (foundTitle) break;
                    }
                }
            }
            
            // Fallback 1: If no preceding H3/P was found, try the block itself (if it's a title block)
            if (!foundTitle) {
                if (block.tagName === 'H3' || block.tagName === 'H2' || (block.tagName === 'P' && block.classList.contains('font-semibold'))) {
                    foundTitle = block.textContent.trim();
                }
            }

            // Final fallback: just the first part of the block's text
            if (!foundTitle) {
                return block.textContent.trim().substring(0, 50) + '...';
            }
            
            // Truncate the title to keep the preview neat
            return foundTitle.substring(0, 100);
        }

        // Function to generate a clickable HTML preview snippet
        function generatePreview(item, query, isNested = false) {
            // Determine the root element containing the searchable content blocks
            const searchableContainer = item.querySelector('.accordion-content');
            
            if (!searchableContainer) return '';

            // Find all distinct content blocks with data-block-id inside the searchable container
            const contentBlocks = searchableContainer.querySelectorAll('[data-block-id]');
            
            let resultsHtml = '';
            
            // Determine the main parent for context and navigation
            const mainParentItem = item.closest('.accordion-item') || item;
            const mainParentTitle = mainParentItem.querySelector('.accordion-header span').textContent;
            const mainParentId = mainParentItem.getAttribute('data-target');

            contentBlocks.forEach(block => {
                const blockId = block.getAttribute('data-block-id');
                const textContent = block.textContent;
                
                // Construct the regex correctly for a dynamic, case-insensitive, global search
                const escapedQuery = query.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                const regex = new RegExp(`(.{0,40})(${escapedQuery})(.{0,40})`, 'gi');
                
                let match;
                let matches = 0;
                let previewText = '';
                let firstMatchFound = false;

                // Find first match for context
                while ((match = regex.exec(textContent)) !== null) {
                    if (!firstMatchFound) {
                        const before = match[1].trim();
                        const found = match[2];
                        const after = match[3].trim();
                        
                        // Highlight the match visually using inline Tailwind classes
                        const highlighted = `<span class="bg-yellow-300 font-bold text-black">${found}</span>`;
                        // Reconstruct the preview text, trimming leading/trailing text and adding ellipses
                        previewText = `${before.length > 0 ? '...' : ''}${before} ${highlighted} ${after}${after.length > 0 ? '...' : ''}`;
                        firstMatchFound = true;
                    }
                    matches++; // Count total matches
                }
                
                // Only generate a preview if a match was found and we have a preview snippet
                if (firstMatchFound) {
                    // Determine context titles
                    const fullContextTitle = isNested ? getNestedHeaderTitle(item) : mainParentTitle;
                    const subContextTitle = getBlockSubTitle(block, isNested ? item : null);
                    
                    resultsHtml += `
                        <div class="search-preview p-4 rounded-lg cursor-pointer transition duration-150 ease-in-out border border-black hover:bg-gray-100" 
                             data-target-id="${isNested ? item.getAttribute('data-target') : mainParentId}"
                             data-main-header-id="${mainParentId}"
                             data-block-id="${blockId}"
                             data-is-nested="${isNested}">
                            <p class="text-xs font-semibold uppercase opacity-70">${fullContextTitle}</p>
                            <p class="font-bold text-sm mt-1 mb-2 truncate">${subContextTitle}</p>
                            <p class="text-xs italic">${previewText} <span class="font-semibold text-gray-600">(${matches} ${matches > 1 ? 'matches' : 'match'})</span></p>
                        </div>
                    `;
                }
            });
            
            return resultsHtml;
        }

        // Attaches click listeners to the dynamically generated preview results
        function addPreviewListeners() {
            document.querySelectorAll('.search-preview').forEach(preview => {
                preview.addEventListener('click', () => {
                    const targetSectionId = preview.getAttribute('data-target-id');
                    const mainHeaderId = preview.getAttribute('data-main-header-id');
                    const blockId = preview.getAttribute('data-block-id');
                    const isNested = preview.getAttribute('data-is-nested') === 'true';

                    let mainItem = document.querySelector(`.accordion-item[data-target="${mainHeaderId}"]`);

                    // 1. Close all existing top-level sections
                    document.querySelectorAll('.accordion-content').forEach(c => {
                         if (c.parentElement.classList.contains('accordion-item')) {
                            c.classList.add('hidden');
                            c.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                        }
                    });
                    
                    // 2. Open the primary parent item
                    if (mainItem) {
                        const mainContent = document.getElementById(mainHeaderId);
                        const mainHeader = mainItem.querySelector('.accordion-header');
                        
                        // Open main content
                        mainContent.classList.remove('hidden');
                        mainHeader.querySelector('svg').classList.add('rotate-180');
                        
                        // 3. Open the nested item if applicable (and close siblings)
                        if (isNested) {
                            let nestedItem = document.querySelector(`.nested-accordion-item[data-target="${targetSectionId}"]`);
                            if (nestedItem) {
                                // Close other nested items within the main parent
                                mainContent.querySelectorAll('.nested-accordion-item').forEach(ni => {
                                    const nc = ni.querySelector('.accordion-content');
                                    const nh = ni.querySelector('.nested-accordion-header');
                                    if(nc && nh) {
                                        nc.classList.add('hidden');
                                        nh.querySelector('svg').classList.remove('rotate-180');
                                    }
                                });
                                
                                const nestedContent = document.getElementById(targetSectionId);
                                const nestedHeader = nestedItem.querySelector('.nested-accordion-header');
                                
                                // Open the specific nested content
                                nestedContent.classList.remove('hidden');
                                nestedHeader.querySelector('svg').classList.add('rotate-180');
                            }
                        }
                    }

                    // 4. Scroll the specific content block into view (using CSS scroll-margin-top for offset)
                    if (blockId) {
                        const targetBlock = document.querySelector(`[data-block-id="${blockId}"]`);
                        if (targetBlock) {
                            targetBlock.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                            
                            // Optional: Flash the block briefly for visual confirmation
                            targetBlock.style.transition = 'background-color 0.5s ease-out';
                            targetBlock.style.backgroundColor = 'rgba(255, 255, 0, 0.2)'; // Light yellow flash
                            setTimeout(() => {
                                targetBlock.style.backgroundColor = '';
                            }, 1000);
                        }
                    }

                    // 5. Clear search bar and results for clean view
                    clearSearchAndResults(); 
                });
            });
        }

        // --- Main Search Event Listener (now calls the wrapped function) ---
        searchInput.addEventListener('input', performSearchLogic);

        // Initial check on page load (in case of browser autofill)
        document.addEventListener('DOMContentLoaded', toggleClearButton);
    </script>
</body>
</html>
